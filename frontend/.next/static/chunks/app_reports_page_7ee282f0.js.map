{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Admin/OneDrive%20-%20Imam%20university/Desktop/Nuthur/frontend/app/reports/page.js"],"sourcesContent":["\"use client\";\r\nimport { useState, useEffect } from \"react\";\r\nimport dynamic from \"next/dynamic\";\r\n\r\n// Import map dynamically without SSR\r\nconst ReportMap = dynamic(() => import(\"../../components/ReportMap\"), {\r\n  ssr: false,\r\n});\r\n\r\nexport default function ReportPage() {\r\n  const [description, setDescription] = useState(\"\");\r\n  const [position, setPosition] = useState(null);\r\n  const [imageBase64, setImageBase64] = useState(\"\");\r\n  const [message, setMessage] = useState(\"\");\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [userLocation, setUserLocation] = useState([24.7136, 46.6753]); // Riyadh as default\r\n\r\n  // Get user location\r\n  useEffect(() => {\r\n    if (navigator.geolocation) {\r\n      navigator.geolocation.getCurrentPosition(\r\n        (pos) => {\r\n          const newPos = [pos.coords.latitude, pos.coords.longitude];\r\n          setUserLocation(newPos);\r\n          setPosition(newPos);\r\n        },\r\n        (err) => {\r\n          console.error(\"Error getting location: \", err);\r\n        }\r\n      );\r\n    }\r\n  }, []);\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    if (!position) {\r\n      setMessage(\"‚ùå Please select a location on the map\");\r\n      return;\r\n    }\r\n    setIsSubmitting(true);\r\n    try {\r\n      const token = localStorage.getItem(\"authToken\");\r\n      if (!token) {\r\n        setMessage(\"‚ö†Ô∏è Please log in first\");\r\n        setIsSubmitting(false);\r\n        return;\r\n      }\r\n\r\n      const res = await fetch(\"http://localhost:5000/reports/create\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n        body: JSON.stringify({\r\n          description,\r\n          location: { lat: position[0], lng: position[1] },\r\n          image: imageBase64,\r\n        }),\r\n      });\r\n\r\n      const data = await res.json();\r\n      if (res.ok) {\r\n        setMessage(\"‚úÖ Report submitted successfully!\");\r\n        setDescription(\"\");\r\n        setPosition(null);\r\n        setImageBase64(\"\");\r\n        setTimeout(() => {\r\n          window.location.href = \"/\";\r\n        }, 2000);\r\n      } else {\r\n        setMessage(data.error || data.message || \"‚ùå Failed to submit report\");\r\n      }\r\n    } catch (error) {\r\n      console.error(error);\r\n      setMessage(\"üö® Server error, please try again later\");\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"container py-5\">\r\n      <h1 className=\"mb-4 text-danger\">Submit a New Report</h1>\r\n\r\n      <form className=\"w-75 mx-auto\" onSubmit={handleSubmit}>\r\n        {/* Description */}\r\n        <div className=\"mb-3\">\r\n          <label className=\"form-label\">Description</label>\r\n          <textarea\r\n            className=\"form-control\"\r\n            placeholder=\"Write your report details here...\"\r\n            value={description}\r\n            onChange={(e) => setDescription(e.target.value)}\r\n            required\r\n            rows=\"4\"\r\n          />\r\n        </div>\r\n\r\n        {/* Map */}\r\n        <div className=\"mb-3\">\r\n          <label className=\"form-label\">Select Location on Map</label>\r\n          <ReportMap\r\n            userLocation={userLocation}\r\n            position={position}\r\n            setPosition={setPosition}\r\n          />\r\n          {position && (\r\n            <div className=\"form-text mt-2\">\r\n              Selected: {position[0].toFixed(6)}, {position[1].toFixed(6)}\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Submit */}\r\n        <button\r\n          type=\"submit\"\r\n          className=\"btn btn-danger w-100\"\r\n          disabled={isSubmitting}\r\n        >\r\n          {isSubmitting ? \"Submitting...\" : \"Submit Report\"}\r\n        </button>\r\n\r\n        {message && <p className=\"mt-3 text-center\">{message}</p>}\r\n      </form>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}